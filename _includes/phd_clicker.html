<link rel="stylesheet" href="/phd_clicker/game.css">
<link rel="stylesheet" href="/phd_clicker/css/agi.css">

<!-- Floating widget trigger -->
<div id="phd-clicker-app" class="font-sans">
  <div id="floating-widget" class="fixed bottom-6 right-6 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold px-4 py-3 rounded-full shadow-lg cursor-pointer flex items-center gap-3" style="z-index:2147482000;">
    <i data-lucide="flask-conical" class="w-5 h-5"></i>
    <span id="widget-text" data-i18n="widgetStart">ÂºÄÂßãÁ†îÁ©∂</span>
    <span id="widget-rp-display" class="hidden text-sm font-mono">RP: 0</span>
  </div>

  <!-- Game container (hidden by default, full-screen overlay) -->
  <div id="game-container" class="hidden fixed inset-0 bg-slate-900 text-slate-200 flex flex-col overflow-y-auto lg:overflow-hidden" style="z-index:2147483000;">
    <div class="h-8 bg-black flex-shrink-0 flex items-center px-4 text-sm text-green-400 font-mono border-b border-slate-700 gap-3">
      <span id="news-prefix" class="font-bold shrink-0" data-i18n="newsPrefix">NEWS:</span>
      <div id="news-ticker" class="overflow-hidden whitespace-nowrap flex-1">
        <span></span>
      </div>
    </div>

            <div id="main-panels" class="flex flex-1 flex-col lg:flex-row overflow-y-auto lg:overflow-hidden pb-24 lg:pb-0 custom-scrollbar">
                        <!-- LEFT PANEL -->
                        <div class="w-full lg:w-1/3 min-w-[280px] border-b lg:border-b-0 lg:border-r border-slate-700 flex flex-col p-4 lg:p-6 bg-slate-900 order-1">
                                      <div class="mb-8 text-center mt-12 lg:mt-0">
                                        <h1 id="title-text" class="text-3xl font-bold text-white mb-1 tracking-tight" data-i18n="title">PhD Clicker</h1>
                                        <div class="flex items-center justify-center gap-2 mb-1">
                                          <p id="subtitle-text" class="text-slate-400 text-sm" data-i18n="subtitle">...</p>
                                          <div id="origin-badge" class="hidden flex items-center gap-1 px-2 py-0.5 rounded border border-slate-600 bg-slate-800 text-[10px] text-slate-300">
                                              <i id="origin-icon" data-lucide="user" class="w-3 h-3"></i>
                                              <span id="generation-display">Gen 1</span>
                                          </div>
                                        </div>
                                      </div>                <div class="text-center mb-8">
              <div id="rp-display" class="text-5xl font-mono font-bold text-indigo-400 mb-2">0</div>
              <div id="rp-label" class="text-sm text-slate-400 uppercase tracking-widest" data-i18n="rpLabel">Research Points (RP)</div>
              <div id="rp-per-second-display" class="text-green-500 font-mono text-lg mt-1">+0 / sec</div>
            </div>
            <div class="flex-1 flex flex-col items-center justify-end lg:justify-center pb-6 gap-4">
              <button id="manual-research-button" class="group relative w-56 h-56 md:w-64 md:h-64 lg:w-[22rem] lg:h-[22rem] rounded-full bg-gradient-to-br from-indigo-600 to-purple-700 shadow-[0_0_30px_rgba(79,70,229,0.3)] hover:shadow-[0_0_70px_rgba(79,70,229,0.5)] active:scale-95 transition-all duration-75 flex flex-col items-center justify-center border-4 border-indigo-400/30 overflow-hidden">
                <i data-lucide="activity" class="w-12 h-12 text-white mb-2 group-hover:animate-bounce"></i>
                <span id="manual-button-label" class="font-bold text-white text-lg" data-i18n="manualButton">...</span>
                <div id="floating-text-container" class="absolute inset-0 pointer-events-none"></div>
              </button>
            </div>
          </div>
      <!-- MIDDLE PANEL -->
      <div id="middle-panel" class="w-full lg:w-1/3 min-w-[280px] border-b lg:border-b-0 lg:border-r border-slate-700 bg-slate-800/50 flex flex-col order-3 lg:order-2 overflow-hidden">
        <div class="p-4 border-b border-slate-700 bg-slate-900/50 shrink-0">
          <div class="flex justify-between items-center mb-2">
            <div class="flex items-center gap-2 text-yellow-500">
              <i data-lucide="book-open" class="w-5 h-5"></i>
              <span id="citations-display" class="font-bold">Citations: 0</span>
              <span id="citations-rate-display" class="text-xs text-yellow-300 font-mono bg-yellow-900/30 px-2 py-0.5 rounded">+0/sec</span>
              <span id="papers-count-display" class="text-xs text-yellow-200 font-mono bg-yellow-900/50 px-2 py-0.5 rounded">ËÆ∫ÊñáÊï∞: 0</span>
            </div>
            <span id="h-index-display" class="text-xs text-slate-500">ÂÖ®Â±Ä‰∫ßÂá∫ +0%</span>
          </div>

          <!-- Publications Summary -->
          <div id="publications-container" class="mb-3 bg-slate-900/40 rounded-lg border border-slate-700/50 overflow-hidden">
            <div class="flex items-center justify-between px-3 py-2 bg-slate-800/50 cursor-pointer hover:bg-slate-800 transition-colors" id="publications-header">
              <div class="flex items-center gap-2">
                <i data-lucide="library" class="w-4 h-4 text-indigo-400"></i>
                <span class="text-xs font-bold text-slate-300 uppercase tracking-wider" data-i18n="publicationsTitle">Publications</span>
              </div>
              <div class="flex items-center gap-2">
                <span id="pub-total-badge" class="text-[10px] font-mono bg-indigo-900/50 text-indigo-300 px-1.5 py-0.5 rounded">0</span>
                <i id="pub-chevron" data-lucide="chevron-down" class="w-3 h-3 text-slate-500 transition-transform duration-200"></i>
              </div>
            </div>
            <!-- Collapsed View: Badges -->
            <div id="pub-summary-view" class="px-3 py-2 flex flex-wrap gap-1.5 min-h-[2.5rem]">
              <span class="text-[10px] text-slate-600 italic" data-i18n="pubEmpty">No papers yet</span>
            </div>
            <!-- Expanded View: List -->
            <div id="pub-detail-view" class="hidden border-t border-slate-800 max-h-48 overflow-y-auto custom-scrollbar bg-slate-900/80">
              <div id="pub-list" class="flex flex-col text-xs"></div>
            </div>
          </div>

          <button id="submit-paper-button" class="w-full mb-2 py-2 bg-indigo-900/30 border border-indigo-700 text-indigo-200 hover:bg-indigo-900/50 rounded text-sm font-bold transition-colors flex items-center justify-between gap-2 px-3">
            <span class="flex items-center gap-2"><i data-lucide="file-plus" class="w-4 h-4"></i> <span id="submit-paper-label" data-i18n="submitPaperButton">...</span></span>
            <span id="submit-paper-cost" class="text-indigo-300 font-mono text-xs">...</span>
          </button>
          <button id="prestige-button" class="w-full py-2 bg-yellow-900/30 border border-yellow-700 text-yellow-500 hover:bg-yellow-900/50 rounded text-sm font-bold transition-colors flex items-center justify-center gap-2">
            <i data-lucide="award" class="w-4 h-4"></i>
            <span id="prestige-label" data-i18n="prestigeButton">...</span>
          </button>
          <button id="advisor-info-btn" class="hidden w-full py-2 bg-purple-900/30 border border-purple-700 text-purple-300 hover:bg-purple-900/50 rounded text-sm font-bold transition-colors flex items-center justify-center gap-2 mt-2">
            <i data-lucide="user-circle" class="w-4 h-4"></i>
            <span id="advisor-info-text" data-i18n="advisorInfoBtn">ÂØºÂ∏à‰ø°ÊÅØ</span>
          </button>

          <!-- AGI ÂØπËØùÊù° -->
          <div id="agi-dialogue-bar" class="hidden mt-2">
            <div class="agi-header">
              <span class="agi-label">[AGI-CORE]</span>
              <button id="agi-minimize-btn" title="Minimize">‚àí</button>
            </div>
            <div id="agi-bar-content">
              <span id="agi-text"></span>
              <span id="agi-cursor" class="agi-cursor">‚ñå</span>
            </div>
          </div>
        </div>
        <div class="p-4 border-b border-slate-700 shrink-0">
          <div class="flex items-center justify-between">
            <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="zap" class="w-4 h-4"></i> <span id="upgrades-title" data-i18n="upgradesTitle">Upgrades</span>
            </h2>
            <button id="upgrades-toggle" class="lg:hidden text-xs text-slate-300 border border-slate-700 px-2 py-1 rounded hover:border-indigo-400 hover:text-white transition-colors" data-i18n="collapse">...</button>
          </div>
        </div>
        <div id="upgrades-container" class="flex-1 overflow-y-auto custom-scrollbar min-h-0">
          <div id="upgrades-wrapper" class="p-4 lg:block">
            <div id="upgrades-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
            <!-- Click Upgrades Section -->
            <div id="click-upgrades-section" class="mt-6">
              <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2 mb-3">
                <i data-lucide="mouse-pointer-click" class="w-3 h-3"></i> <span id="click-upgrades-title" data-i18n="clickUpgradesTitle">Click Upgrades</span>
              </h3>
              <div id="click-upgrades-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
            </div>
          </div>
        </div>
        <div class="p-4 border-t border-slate-700 bg-slate-900/50 flex justify-between items-center shrink-0">
          <div class="flex gap-3">
            <button id="reset-button" class="text-red-500 hover:text-red-400 flex items-center gap-1 text-xs">
              <i data-lucide="trash-2" class="w-3 h-3"></i> <span id="reset-label" data-i18n="resetButton">Reset Save</span>
            </button>
            <button id="connections-btn" class="hidden text-amber-400 hover:text-amber-300 flex items-center gap-1 text-xs">
              <i data-lucide="users" class="w-3 h-3"></i> <span data-i18n="connectionsBtn">Connections</span>
            </button>
          </div>
          <div class="text-slate-500 text-xs flex items-center gap-1">
            <i data-lucide="save" class="w-3 h-3"></i> <span id="autosave-label" data-i18n="autosaving">Auto-saving</span>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="w-full lg:w-1/3 min-w-[260px] bg-slate-900 flex flex-col overflow-hidden order-2 lg:order-3">
        <div class="p-4 border-b border-slate-700 shadow-md z-10 sticky top-0">
          <div class="flex items-center justify-between">
            <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="cpu" class="w-4 h-4"></i> <span id="facilities-title" data-i18n="facilitiesTitle">ËÆæÊñΩ</span>
            </h2>
            <button id="buildings-toggle" class="lg:hidden text-xs text-slate-300 border border-slate-700 px-2 py-1 rounded hover:border-indigo-400 hover:text-white transition-colors" data-i18n="collapse">...</button>
          </div>
        </div>
        <div id="buildings-wrapper" class="flex-1 lg:h-full overflow-y-auto custom-scrollbar">
          <div id="buildings-list" class="p-2 flex flex-col gap-2"></div>
        </div>
      </div>
    </div>

    <!-- Bottom-left controls (visible only when game is open) -->
    <div class="absolute top-12 left-4 lg:top-auto lg:bottom-6 lg:left-6 flex items-center gap-3 z-[2147484000]">
      <button id="lang-toggle" class="px-4 py-2 md:px-5 md:py-2.5 text-sm md:text-base font-semibold text-slate-100 border border-slate-600 bg-slate-900/80 hover:bg-slate-800/80 rounded-lg shadow-lg transition-colors" data-i18n="langButton">
        English
      </button>
      <button id="minimize-button" class="px-4 py-2 md:px-5 md:py-2.5 text-sm md:text-base font-semibold text-slate-100 bg-slate-800/80 hover:bg-slate-700/80 border border-slate-600 rounded-lg shadow-lg transition-colors" data-i18n="minimizeButton">
        ÊúÄÂ∞èÂåñ
      </button>
    </div>

    <!-- Modals and Dev Console are now INSIDE the game container -->
    <div id="submission-modal" class="hidden fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-[2147484001] overflow-y-auto">
      <div class="max-w-4xl mx-auto px-4 py-10">
        <div class="bg-slate-900 border border-indigo-800/60 rounded-2xl shadow-2xl overflow-hidden">
          <div class="flex items-center justify-between px-6 py-4 border-b border-slate-800 bg-slate-900/80">
            <div>
              <p class="text-xs uppercase tracking-widest text-indigo-300 mb-1" data-i18n="submissionTitleSmall">Paper Submission</p>
              <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <i data-lucide="file-text" class="w-5 h-5 text-indigo-300"></i>
                <span id="submission-title" data-i18n="submissionTitle">ÂèëË°®ËÆ∫Êñá ¬∑ Rebuttal</span>
              </h3>
            </div>
            <div class="flex items-center gap-3">
              <div id="submission-current-rp" class="text-xs font-mono text-slate-400 bg-slate-800 px-3 py-1 rounded-full">RP: 0</div>
              <button id="submission-close" class="text-slate-400 hover:text-white border border-slate-700 hover:border-red-400 rounded-full w-9 h-9 flex items-center justify-center transition-colors">
                <i data-lucide="x" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
          <div id="tier-stage" class="p-6 space-y-4">
            <!-- Research Focus & Title Generator -->
            <div class="mb-5 p-4 bg-slate-800/80 rounded-xl border border-indigo-500/30 shadow-inner">
                <div class="flex items-center justify-between mb-2">
                    <label for="research-focus-input" class="text-xs font-bold text-indigo-300 uppercase tracking-wider flex items-center gap-1">
                        <i data-lucide="microscope" class="w-3 h-3"></i> <span data-i18n="researchFocusLabel">Research Focus</span>
                    </label>
                    <span class="text-[10px] text-slate-500" data-i18n="researchFocusHint">Separate multiple topics with commas</span>
                </div>

                <input
                    id="research-focus-input"
                    type="text"
                    class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-600 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all"
                    placeholder="e.g. AI Safety, Sleep, Coffee, Generative Agents..."
                    autocomplete="off"
                />

                <div class="mt-4 flex flex-col md:flex-row md:items-center gap-3 bg-black/20 p-3 rounded-lg border border-slate-700/50">
                    <div class="flex-1">
                        <div class="text-[10px] text-slate-500 uppercase tracking-wide mb-1" data-i18n="draftTitleLabel">Draft Title</div>
                        <div id="generated-title-display" class="font-serif text-lg text-slate-200 italic font-medium leading-snug">
                            "Generating..."
                        </div>
                    </div>
                    <button id="reroll-title-btn" class="shrink-0 px-3 py-2 bg-slate-700 hover:bg-indigo-600 text-slate-200 hover:text-white rounded-md text-xs font-bold transition-all flex items-center gap-2 border border-slate-600 hover:border-indigo-400">
                        <i data-lucide="refresh-cw" class="w-3 h-3"></i> <span data-i18n="rerollBtn">Reroll</span>
                    </button>
                </div>
            </div>

            <div class="flex items-center justify-between text-sm text-slate-400">
              <div class="flex items-center gap-2">
                <span id="step1-label" class="px-2 py-1 rounded bg-indigo-900/40 text-indigo-200 text-xs font-bold uppercase" data-i18n="step1Label">Step 1</span>
                <span id="step1-desc" data-i18n="submissionStep1">...</span>
              </div>
              <div id="submission-min-cost" class="text-xs text-slate-500"></div>
            </div>
            <div id="tier-list" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
          </div>

          <!-- New Detail View for Investment -->
          <div id="tier-detail-view" class="hidden p-6 space-y-6">
            <div class="flex items-center gap-3 mb-2">
              <button id="detail-back-btn" class="text-slate-400 hover:text-white transition-colors p-1 rounded hover:bg-slate-800">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
              </button>
              <h3 id="detail-title" class="text-xl font-bold text-white">Tier Name</h3>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
              <div class="flex justify-between items-end mb-2">
                <span class="text-sm text-slate-400" data-i18n="detailBaseCostLabel">Base Cost (Inflated)</span>
                <span id="detail-base-cost" class="text-lg font-mono text-indigo-300">500 RP</span>
              </div>
              <div class="flex justify-between items-end mb-4">
                <span class="text-sm text-slate-400" data-i18n="detailInvestLabel">Invest Extra RP</span>
                <div class="flex items-center gap-2">
                  <input id="detail-invest-input" type="number" class="w-28 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right font-mono text-white text-sm focus:border-indigo-500 outline-none" value="0">
                  <span class="text-xs text-slate-500">RP</span>
                </div>
              </div>
              <div class="relative h-6 mb-1">
                <input id="detail-invest-slider" type="range" class="absolute w-full h-2 top-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500" min="0" max="100" value="0">
              </div>
              <div class="flex justify-between text-xs text-slate-500 mt-1">
                <span>0</span>
                <span id="detail-max-invest"><span data-i18n="detailMax">Max</span></span>
              </div>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
              <div class="text-sm text-slate-400 mb-2" data-i18n="detailSuccessProbLabel">Success Probability</div>
              <div class="flex items-end gap-2 mb-3">
                <span id="detail-total-chance" class="text-3xl font-bold text-emerald-400">60%</span>
                <span id="detail-chance-breakdown" class="text-xs text-slate-500 mb-1.5">(Base: 60% + Bonus: 0%)</span>
              </div>
              <div class="w-full bg-slate-700 rounded-full h-2.5 overflow-hidden">
                <div id="detail-chance-bar" class="bg-emerald-500 h-2.5 rounded-full transition-all duration-300" style="width: 60%"></div>
              </div>
              <div id="detail-warning" class="mt-3 text-xs text-amber-400 flex items-start gap-1 hidden">
                <i data-lucide="alert-triangle" class="w-3 h-3 mt-0.5 shrink-0"></i>
                <span>Warning: Rebuttal performance can swing result by ¬±15%.</span>
              </div>
            </div>

            <button id="detail-start-btn" class="w-full py-3 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-bold shadow-lg shadow-indigo-900/20 transition-all flex items-center justify-center gap-2">
              <span data-i18n="detailStartBtn">Start Submission</span>
              <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </button>
          </div>
          <div id="question-stage" class="hidden p-6 space-y-3 border-t border-slate-800 bg-slate-900/70">
            <div class="flex items-center justify-between text-sm text-slate-400 mb-2">
              <div class="flex items-center gap-2">
                <span id="step2-label" class="px-2 py-1 rounded bg-indigo-900/40 text-indigo-200 text-xs font-bold uppercase" data-i18n="step2Label">Step 2</span>
                <span id="question-tier-label" data-i18n="submissionStep2">Rebuttal Q&A</span>
              </div>
              <div class="flex items-center gap-3">
                <div class="hidden md:block relative w-32 h-2 bg-slate-700 rounded-full overflow-hidden" title="Win Probability">
                  <div id="rebuttal-gauge-fill" class="absolute top-0 left-0 h-full bg-emerald-500 transition-all duration-500" style="width: 50%"></div>
                </div>
                <div class="flex items-center gap-1">
                  <span id="question-progress" class="text-xs text-slate-500 mr-2">Q 1/3</span>
                  <span id="question-chance" class="text-emerald-300 font-mono font-bold text-lg">80%</span>
                </div>
              </div>
            </div>
            <div class="rounded-xl border border-slate-800 bg-slate-800/60 shadow-lg p-4">
              <div class="flex items-center gap-3 mb-3">
                <div id="question-reviewer-badge" class="w-10 h-10 rounded-full bg-red-500/20 border border-red-400/60 flex items-center justify-center text-red-200 font-bold">#2</div>
                <div class="leading-tight">
                  <div id="question-reviewer-name" class="text-sm font-semibold text-white">Reviewer #2</div>
                </div>
              </div>
              <div id="question-text" class="text-lg text-slate-100 font-semibold leading-snug mb-3">...</div>
              <div id="options-container" class="space-y-2"></div>
              <div id="question-feedback" class="hidden mt-3 text-sm text-emerald-300"></div>
              <div class="mt-4 flex justify-end">
                <button id="question-next-btn" class="hidden px-4 py-2 rounded-lg border border-indigo-500 text-indigo-100 bg-indigo-900/40 hover:bg-indigo-800/60 transition-colors text-sm font-semibold">...</button>
              </div>
            </div>
          </div>
          <div id="result-stage" class="hidden p-6 border-t border-slate-800 bg-slate-900/80">
            <div id="result-letter" class="rounded-xl border border-slate-800 bg-slate-800/70 shadow-lg p-4 mb-4">
              <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
                <span data-i18n="letterFrom">From: review@conference.org</span>
                <span id="result-letter-date" data-i18n="letterDate">Today</span>
              </div>
              <div id="result-letter-subject" class="text-sm font-semibold text-white mb-2" data-i18n="letterSubject">[Decision] Your Submission</div>
              <div id="result-letter-body" class="text-sm text-slate-200 leading-relaxed whitespace-pre-line">...</div>
            </div>
            <div id="result-settlement" class="hidden">
              <div class="flex items-center gap-3 mb-3">
                <div id="result-icon" class="w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold bg-emerald-500/20 text-emerald-200 border border-emerald-400/60">A</div>
                <div>
                  <div id="result-title" class="text-2xl font-bold text-emerald-300" data-i18n="resultAccept">Accept!</div>
                  <div id="result-detail" class="text-sm text-slate-300">...</div>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                <div class="p-3 rounded-lg border border-slate-800 bg-slate-800/60">
                  <div class="text-xs text-slate-400 mb-1" data-i18n="resultConfLabel">‰ºöËÆÆ</div>
                  <div id="result-tier" class="text-sm font-semibold text-white">...</div>
                </div>
                <div class="p-3 rounded-lg border border-slate-800 bg-slate-800/60">
                  <div class="text-xs text-slate-400 mb-1" data-i18n="resultChanceLabel">ÊúÄÁªà‰∏≠Á®øÁéá</div>
                  <div id="result-chance" class="text-sm font-semibold text-white">...</div>
                </div>
                <div class="p-3 rounded-lg border border-slate-800 bg-slate-800/60">
                  <div class="text-xs text-slate-400 mb-1" data-i18n="resultRollLabel">Âà§ÂÆö</div>
                  <div id="result-roll" class="text-sm font-semibold text-white">...</div>
                </div>
              </div>
              <div id="result-rewards" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4"></div>
              <div class="flex items-center justify-between">
                <div id="result-flavor" class="text-sm text-slate-400">...</div>
                <div class="flex gap-2">
                  <button id="result-button" class="px-4 py-2 rounded-lg border border-indigo-600 text-indigo-200 hover:bg-indigo-800/60 transition-colors" data-i18n="resultRetry">ÂÜçÊäï‰∏ÄÁØá</button>
                  <button id="submission-close-bottom" class="px-3 py-2 rounded-lg border border-slate-700 text-slate-300 hover:text-white hover:border-slate-500 transition-colors" data-i18n="resultClose">ÂÖ≥Èó≠</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Connections Modal -->
    <div id="connections-modal" class="hidden fixed inset-0 bg-slate-950/90 backdrop-blur-md z-[2147484005] overflow-y-auto">
      <div class="max-w-5xl mx-auto px-4 py-10">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h2 class="text-3xl font-bold text-amber-400 flex items-center gap-3">
              <i data-lucide="network" class="w-8 h-8"></i>
              <span data-i18n="connectionsTitle">Academic Network</span>
            </h2>
            <p class="text-slate-400 text-sm mt-1" data-i18n="connectionsSubtitle">Buy permanent upgrades with Reputation.</p>
            <div class="mt-2 text-[10px] text-rose-400/80 bg-rose-950/20 px-2 py-1 rounded inline-block border border-rose-900/30">
                <i data-lucide="trending-up" class="w-3 h-3 inline mr-1"></i> <span data-i18n="socialInflation">Social Inflation: Each connection purchased doubles the cost of others.</span>
            </div>
          </div>
          <div class="flex items-center gap-6">
            <div class="text-right">
              <div class="text-xs text-slate-500 uppercase tracking-widest" data-i18n="reputationLabel">Reputation</div>
              <div id="rep-display" class="text-2xl font-mono font-bold text-amber-200">0</div>
            </div>
            <button id="connections-close" class="text-slate-400 hover:text-white p-2 rounded-full hover:bg-slate-800 transition-colors">
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
          </div>
        </div>

        <div id="connections-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Cards rendered by JS -->
        </div>
      </div>
    </div>

    <!-- Phase 1: Prestige Confirmation Modal -->
    <div id="prestige-confirmation-modal" class="fixed inset-0 z-[2147484020] bg-black/90 flex items-center justify-center p-6 hidden">
      <div class="bg-slate-900 border-2 border-amber-600/50 rounded-xl max-w-2xl w-full shadow-[0_0_50px_rgba(245,158,11,0.3)] p-8">
        <div class="text-center mb-8">
          <div class="text-amber-500 text-sm uppercase tracking-widest mb-2">‚ö†Ô∏è IMPORTANT DECISION</div>
          <h2 class="text-3xl font-bold text-white mb-2" data-i18n="prestigeConfirmTitle">Ready to Defend Thesis?</h2>
          <div class="text-slate-400 text-sm">
            <span>Generation <span id="confirm-generation">1</span></span>
            <span class="mx-2">‚Ä¢</span>
            <span id="confirm-subtitle">Ph.D. Candidate</span>
          </div>
        </div>
        <div class="bg-gradient-to-br from-amber-900/30 to-amber-800/20 border-2 border-amber-500/50 rounded-lg p-6 mb-6">
          <div class="text-center">
            <div class="text-amber-400/80 text-xs uppercase tracking-wider mb-2" data-i18n="repGainLabel">Reputation Gained</div>
            <div id="confirm-rep-gain" class="text-6xl font-bold text-amber-400 font-mono">+0</div>
            <div class="text-amber-500/60 text-xs mt-2" data-i18n="repGainHint">Permanently boosts next generation</div>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          <div class="bg-red-900/10 border border-red-700/30 rounded-lg p-4">
            <div class="text-red-400 font-bold mb-3 flex items-center gap-2">
              <i data-lucide="x-circle" class="w-4 h-4"></i>
              <span data-i18n="youLose">You Will Lose</span>
            </div>
            <ul class="text-slate-300 text-sm space-y-2">
              <li class="flex items-start gap-2"><span class="text-red-500 mt-0.5">‚Ä¢</span> <span data-i18n="loseRP">All RP & Citations</span></li>
              <li class="flex items-start gap-2"><span class="text-red-500 mt-0.5">‚Ä¢</span> <span data-i18n="loseBuild">All Buildings & Upgrades</span></li>
              <li class="flex items-start gap-2"><span class="text-red-500 mt-0.5">‚Ä¢</span> <span data-i18n="losePapers">Published Papers Record</span></li>
            </ul>
          </div>
          <div class="bg-green-900/10 border border-green-700/30 rounded-lg p-4">
            <div class="text-green-400 font-bold mb-3 flex items-center gap-2">
              <i data-lucide="check-circle" class="w-4 h-4"></i>
              <span data-i18n="youKeep">You Will Keep</span>
            </div>
            <ul class="text-slate-300 text-sm space-y-2">
              <li class="flex items-start gap-2"><span class="text-green-500 mt-0.5">‚Ä¢</span> <span data-i18n="keepConn">Connections (Network)</span></li>
              <li class="flex items-start gap-2"><span class="text-green-500 mt-0.5">‚Ä¢</span> <span data-i18n="keepRep">Total Reputation</span></li>
            </ul>
          </div>
        </div>
        <div class="flex justify-end gap-4">
          <button id="prestige-confirm-cancel" class="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors" data-i18n="cancelBtn">Not Yet</button>
          <button id="prestige-confirm-accept" class="px-8 py-3 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white font-bold rounded-lg shadow-lg shadow-amber-500/30 transition-all active:scale-95 flex items-center gap-2">
            <i data-lucide="award" class="w-5 h-5"></i>
            <span data-i18n="prestigeConfirmBtn">Defend & Rebirth</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Phase 2: Transition Animation Screen -->
    <div id="prestige-transition-screen" class="fixed inset-0 z-[2147484021] bg-black flex flex-col items-center justify-center hidden">
      <div id="transition-current" class="text-center mb-8">
        <div class="text-slate-600 text-sm uppercase tracking-widest mb-2">Generation</div>
        <div id="transition-gen-old" class="text-7xl font-black text-slate-700 tracking-wider">1</div>
        <div class="mt-4"><i data-lucide="graduation-cap" class="w-16 h-16 text-slate-700 mx-auto"></i></div>
      </div>
      <div class="w-64 h-1 bg-slate-800 rounded-full overflow-hidden my-8">
        <div id="transition-progress" class="h-full bg-gradient-to-r from-amber-600 to-amber-400 w-0 transition-all duration-[2000ms] ease-out"></div>
      </div>
      <div id="transition-comment" class="text-center max-w-md opacity-0 transition-opacity duration-1000 px-6">
        <div class="text-slate-500 italic text-lg" id="transition-comment-text">"..."</div>
      </div>
      <div id="transition-next" class="text-center mt-8 translate-y-20 opacity-0 transition-all duration-1000">
        <div class="text-slate-600 text-sm uppercase tracking-widest mb-2">Generation</div>
        <div id="transition-gen-new" class="text-7xl font-black text-amber-500 tracking-wider">2</div>
        <div class="mt-4"><i id="transition-origin-icon" data-lucide="users" class="w-16 h-16 text-amber-500 mx-auto"></i></div>
      </div>
    </div>

    <!-- Phase 3: Statistics Modal (The Card) -->
    <div id="prestige-statistics-modal" class="fixed inset-0 z-[2147484022] bg-black/95 overflow-y-auto p-6 hidden">
      <div class="max-w-5xl mx-auto">
        <div class="bg-gradient-to-r from-slate-800 to-slate-900 border-b border-amber-500/30 rounded-t-xl p-6 flex justify-between items-center sticky top-0 z-10 shadow-lg">
          <div>
            <h2 class="text-2xl font-bold text-white flex items-center gap-2">
              <i data-lucide="bar-chart-3" class="w-6 h-6 text-amber-500"></i>
              <span>Generation <span id="stats-generation">1</span> Summary</span>
            </h2>
            <div class="text-slate-400 text-sm mt-1"><span id="stats-date-range">...</span></div>
          </div>
          <button id="stats-close-btn" class="text-slate-400 hover:text-white transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>

        <div id="stats-cards-container" class="space-y-4 p-6">
          <!-- Card 1: Academic -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-indigo-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-indigo-500/20">
              <div class="w-10 h-10 bg-indigo-500/20 rounded-lg flex items-center justify-center"><i data-lucide="trophy" class="w-5 h-5 text-indigo-400"></i></div>
              <h3 class="text-xl font-bold text-white" data-i18n="statsAcademic">Academic Output</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_totalPapers">Total Papers</div><div class="text-2xl font-bold text-white" id="stat-total-papers">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_topPapers">Top-Tier Papers</div><div class="text-2xl font-bold text-indigo-400" id="stat-top-papers">0</div><div class="text-xs text-slate-500 mt-1" id="stat-venue-list">-</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_citations">Total Citations</div><div class="text-2xl font-bold text-emerald-400" id="stat-citations">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_hIndex">h-index</div><div class="text-2xl font-bold text-yellow-400" id="stat-h-index">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_rejections">Rejections</div><div class="text-2xl font-bold text-red-400" id="stat-rejections">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_rebuttalAcc">Rebuttal Accuracy</div><div class="text-2xl font-bold text-purple-400" id="stat-rebuttal-acc">0%</div></div>
            </div>
          </div>

          <!-- Card 2: Intensity -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-amber-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-amber-500/20">
              <div class="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center"><i data-lucide="zap" class="w-5 h-5 text-amber-400"></i></div>
              <h3 class="text-xl font-bold text-white" data-i18n="statsIntensity">Research Intensity</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_clicks">Manual Clicks</div><div class="text-2xl font-bold text-white" id="stat-clicks">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_totalRp">Total RP Earned</div><div class="text-2xl font-bold text-green-400" id="stat-total-rp">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_coffee">Coffee Consumed</div><div class="text-2xl font-bold text-amber-600" id="stat-coffee">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_playtime">Playtime</div><div class="text-2xl font-bold text-cyan-400" id="stat-playtime">0m</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_peakRps">Peak RP/sec</div><div class="text-2xl font-bold text-emerald-400" id="stat-peak-rps">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_avgRps">Avg RP/sec</div><div class="text-2xl font-bold text-emerald-300" id="stat-avg-rps">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_buildings">Buildings</div><div class="text-2xl font-bold text-blue-400" id="stat-buildings">0</div></div>
              <div class="stat-item"><div class="text-slate-400 text-xs uppercase mb-1" data-i18n="statLabel_upgrades">Upgrades</div><div class="text-2xl font-bold text-purple-400" id="stat-upgrades">0</div></div>
            </div>
          </div>

          <!-- Card 3: RP Source -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-green-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-green-500/20">
              <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center"><i data-lucide="pie-chart" class="w-5 h-5 text-green-400"></i></div>
              <h3 class="text-xl font-bold text-white">RP Breakdown</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div class="text-center p-4 bg-slate-900/50 rounded-lg">
                <div class="text-xs text-slate-400 uppercase mb-2" data-i18n="statLabel_clickSource">Clicking</div>
                <div class="text-3xl font-bold text-yellow-400" id="stat-rp-click-pct">0%</div>
                <div class="text-sm text-slate-500 mt-1" id="stat-rp-click-amt">0 RP</div>
              </div>
              <div class="text-center p-4 bg-slate-900/50 rounded-lg">
                <div class="text-xs text-slate-400 uppercase mb-2" data-i18n="statLabel_computeSource">Compute</div>
                <div class="text-3xl font-bold text-blue-400" id="stat-rp-compute-pct">0%</div>
                <div class="text-sm text-slate-500 mt-1" id="stat-rp-compute-amt">0 RP</div>
              </div>
              <div class="text-center p-4 bg-slate-900/50 rounded-lg">
                <div class="text-xs text-slate-400 uppercase mb-2" data-i18n="statLabel_academicSource">Academic</div>
                <div class="text-3xl font-bold text-purple-400" id="stat-rp-academic-pct">0%</div>
                <div class="text-sm text-slate-500 mt-1" id="stat-rp-academic-amt">0 RP</div>
              </div>
            </div>
            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4 flex justify-between items-center">
              <span class="text-xs text-green-400 uppercase" data-i18n="statLabel_topBuilding">Top Contributor</span>
              <div class="text-right">
                <span class="font-bold text-white block" id="stat-top-building-name">-</span>
                <span class="text-green-400 font-mono text-xs" id="stat-top-building-value">0 RP</span>
              </div>
            </div>
          </div>

          <!-- Card 4: Fun & Badges -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-pink-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-pink-500/20">
              <div class="w-10 h-10 bg-pink-500/20 rounded-lg flex items-center justify-center"><i data-lucide="sparkles" class="w-5 h-5 text-pink-400"></i></div>
              <h3 class="text-xl font-bold text-white">Fun Stats</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
              <div class="flex justify-between p-3 bg-slate-900/50 rounded"><span class="text-slate-300 text-sm" data-i18n="statLabel_oom">üêõ OOM Errors</span><span class="font-bold text-red-400" id="stat-oom">0</span></div>
              <div class="flex justify-between p-3 bg-slate-900/50 rounded"><span class="text-slate-300 text-sm" data-i18n="statLabel_lucky">üé≤ Lucky Papers</span><span class="font-bold text-yellow-400" id="stat-lucky">0</span></div>
              <div class="flex justify-between p-3 bg-slate-900/50 rounded"><span class="text-slate-300 text-sm" data-i18n="statLabel_unlucky">üò¢ Unlucky Rejects</span><span class="font-bold text-purple-400" id="stat-unlucky">0</span></div>
              <div class="flex justify-between p-3 bg-slate-900/50 rounded"><span class="text-slate-300 text-sm" data-i18n="statLabel_closest">üéØ Closest Call</span><span class="font-bold text-orange-400" id="stat-closest">0%</span></div>
            </div>
            <div class="col-span-1 md:col-span-2 flex flex-wrap gap-2 mt-2">
              <div id="badge-perfect" class="hidden px-3 py-1 bg-yellow-500/20 border border-yellow-500/50 rounded-full text-xs text-yellow-300">‚≠ê Perfect Rebuttal</div>
              <div id="badge-never-reject" class="hidden px-3 py-1 bg-green-500/20 border border-green-500/50 rounded-full text-xs text-green-300">‚úÖ Never Rejected</div>
              <div id="badge-idle" class="hidden px-3 py-1 bg-blue-500/20 border border-blue-500/50 rounded-full text-xs text-blue-300">üí§ True Idle Master</div>
            </div>
          </div>

          <!-- Card 5: Social -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-cyan-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-cyan-500/20">
              <div class="w-10 h-10 bg-cyan-500/20 rounded-lg flex items-center justify-center"><i data-lucide="users" class="w-5 h-5 text-cyan-400"></i></div>
              <h3 class="text-xl font-bold text-white">Networking</h3>
            </div>
            <div class="space-y-3">
              <div class="flex justify-between"><span class="text-slate-400 text-sm" data-i18n="statLabel_connections">Connections Owned</span><span class="font-bold text-cyan-400" id="stat-connections-count">0</span></div>
              <div id="stat-connections-list" class="flex flex-wrap gap-2"></div>
              <div class="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-4 mt-4">
                <div class="text-xs text-cyan-400 uppercase mb-2" data-i18n="statLabel_mvc">Most Valuable Connection</div>
                <div class="flex justify-between"><span class="font-bold text-white" id="stat-mvc-name">-</span><span class="text-cyan-400 font-mono" id="stat-mvc-value">0 RP</span></div>
              </div>
              <div class="bg-amber-900/20 border border-amber-500/30 rounded-lg p-4 mt-2">
                <div class="text-xs text-amber-400 uppercase mb-2" data-i18n="statLabel_repEarned">Reputation Status</div>
                <div class="flex justify-between"><span class="text-slate-300">Earned this run</span><span class="font-bold text-amber-400" id="stat-rep-earned">+0</span></div>
                <div class="flex justify-between mt-1"><span class="text-slate-300 text-sm" data-i18n="statLabel_inflation">Social Inflation</span><span class="text-red-400 text-sm" id="stat-social-inflation">x1</span></div>
              </div>
            </div>
          </div>

          <!-- Card 6: Playstyle -->
          <div class="stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-purple-500/30 rounded-lg p-6 backdrop-blur-sm">
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-purple-500/20">
              <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center"><i data-lucide="brain" class="w-5 h-5 text-purple-400"></i></div>
              <h3 class="text-xl font-bold text-white">Playstyle Analysis</h3>
            </div>
            <div class="text-center mb-4">
              <div class="text-xs text-slate-400 uppercase mb-2" data-i18n="statLabel_archetype">Archetype</div>
              <div class="text-3xl font-bold text-purple-400 mb-2" id="stat-playstyle-type">-</div>
              <div class="text-slate-300 italic text-sm" id="stat-playstyle-desc">-</div>
            </div>
            <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4 text-center">
              <div class="text-xs text-purple-400 uppercase mb-1" data-i18n="statLabel_strategy">Primary Strategy</div>
              <div class="font-bold text-white capitalize" id="stat-primary-strategy">-</div>
            </div>
          </div>

          <!-- Card 7: Advisor -->
          <div class="col-span-1 md:col-span-2 lg:col-span-3 stats-card bg-gradient-to-br from-slate-800/80 to-slate-900/80 border border-slate-500/30 rounded-lg p-6 backdrop-blur-sm relative overflow-hidden">
            <div class="absolute -right-8 -top-8 opacity-5 pointer-events-none">
              <div class="border-8 border-amber-500 text-amber-500 font-black text-9xl uppercase p-4 -rotate-12">APPROVED</div>
            </div>
            <div class="flex items-center gap-3 mb-4 pb-3 border-b border-slate-500/20 relative z-10">
              <div class="w-10 h-10 bg-slate-500/20 rounded-lg flex items-center justify-center"><i data-lucide="message-circle" class="w-5 h-5 text-slate-400"></i></div>
              <h3 class="text-xl font-bold text-white">Advisor's Comment</h3>
            </div>
            <div class="relative z-10">
              <div class="text-xl italic text-slate-200 leading-relaxed mb-4" id="stat-advisor-comment">"..."</div>
              <div class="text-xs text-slate-500" id="stat-advisor-reason">- Evaluation based on: ...</div>
            </div>
          </div>
        </div>

        <!-- Footer Start Button -->
        <div class="bg-slate-900 border-t border-amber-500/30 rounded-b-xl p-6 text-center sticky bottom-0 z-20 shadow-[0_-10px_30px_rgba(0,0,0,0.5)]">
          <button id="stats-start-new-btn" class="px-10 py-4 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white text-lg font-bold rounded-lg shadow-lg shadow-amber-500/30 transition-all active:scale-95 inline-flex items-center gap-3">
            <i data-lucide="rocket" class="w-6 h-6"></i>
            <span data-i18n="startNewLifeBtn">Start New Academic Life</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Heritage Intro Modal -->
    <div id="heritage-intro-modal" class="hidden fixed inset-0 z-[2147484023] bg-black flex flex-col items-center justify-center p-6 text-center select-none">
        <div class="animate-fade-in-up space-y-8 max-w-lg">
            <div>
                <h1 id="intro-gen-title" class="text-5xl md:text-6xl font-black text-slate-700 tracking-[0.2em] mb-2">GENERATION 1</h1>
                <div class="h-1 w-24 bg-indigo-500 mx-auto rounded-full"></div>
            </div>

            <div class="space-y-2">
                <p class="text-lg text-slate-400" data-i18n="introFatherWas">Your academic ancestor was a...</p>
                <h2 id="intro-origin-name" class="text-3xl md:text-4xl font-bold text-indigo-400">Undefined</h2>
                <div class="flex justify-center my-4">
                    <i id="intro-origin-icon" data-lucide="user" class="w-16 h-16 text-slate-600"></i>
                </div>
            </div>

            <div class="bg-slate-900 border border-slate-800 p-6 rounded-xl relative">
                <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-black px-3 text-xs text-indigo-500 uppercase tracking-widest border border-slate-800 rounded">Inherited Trait</div>
                <p id="intro-buff-desc" class="text-slate-300 italic leading-relaxed">...</p>
            </div>

            <button id="intro-start-btn" class="mt-8 px-8 py-4 bg-white text-black font-bold text-xl rounded hover:scale-105 transition-transform shadow-[0_0_30px_rgba(255,255,255,0.2)]">
                Start Research
            </button>
        </div>
    </div>

    <!-- Advisor Selection Modal -->
    <div id="advisor-modal" class="hidden fixed inset-0 z-[2147484024] bg-black/95 flex items-center justify-center p-4 overflow-y-auto">
      <div class="bg-slate-900 border border-indigo-500/50 rounded-2xl max-w-2xl w-full mx-4 shadow-2xl shadow-indigo-500/20">
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-900/50 to-purple-900/50 px-6 py-4 rounded-t-2xl border-b border-indigo-500/30">
          <h2 class="text-2xl font-bold text-white text-center flex items-center justify-center gap-3">
            <i data-lucide="user-check" class="w-7 h-7 text-indigo-400"></i>
            <span data-i18n="advisorSelectTitle">ÈÄâÊã©ÂØºÂ∏à</span>
          </h2>
          <p class="text-slate-400 text-sm text-center mt-1" data-i18n="advisorSelectSubtitle">Your advisor will provide bonuses throughout this generation</p>
        </div>

        <!-- Advisor Info -->
        <div class="p-6">
          <!-- Advisor Name -->
          <div class="mb-4">
            <label class="text-xs text-slate-400 uppercase tracking-wider block mb-2" data-i18n="advisorNameLabel">Advisor Name</label>
            <input id="advisor-name-input" type="text"
              class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-lg text-white font-semibold focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all"
              placeholder="Dr. Anonymous"
              onchange="window.AdvisorUI.updateName(this.value)">
          </div>

          <!-- Legend Advisor Title/Desc (hidden for random) -->
          <div id="advisor-title" class="hidden text-lg font-bold text-amber-400 text-center mb-1"></div>
          <div id="advisor-desc" class="hidden text-sm text-slate-400 text-center italic mb-4"></div>

          <!-- Lock Info -->
          <div id="advisor-lock-info" class="hidden text-xs text-amber-400 text-center mb-4 flex items-center justify-center gap-2">
            <i data-lucide="lock" class="w-3 h-3"></i>
            <span>Lock slots: 0/0</span>
          </div>

          <!-- Traits Grid -->
          <div class="mb-4">
            <label class="text-xs text-slate-400 uppercase tracking-wider block mb-3" data-i18n="advisorTraitsLabel">Traits</label>
            <div id="advisor-traits" class="grid gap-3">
              <!-- Traits rendered by JS -->
            </div>
          </div>

          <!-- Legend Advisors Section -->
          <div id="legend-advisors" class="hidden mb-4 p-4 bg-amber-900/20 border border-amber-500/30 rounded-lg">
            <!-- Legend advisor buttons rendered by JS -->
          </div>
        </div>

        <!-- Actions -->
        <div class="px-6 py-4 bg-slate-800/50 rounded-b-2xl border-t border-slate-700 flex flex-wrap gap-3 justify-center">
          <button id="advisor-reroll-btn" onclick="window.AdvisorUI.reroll()"
            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg text-sm font-semibold transition-all flex items-center gap-2 border border-slate-600">
            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
            <span data-i18n="advisorRerollBtn">ÈáçÈöèÁâπË¥®</span>
          </button>
          <button id="advisor-switch-btn" onclick="window.AdvisorUI.switchAdvisor()"
            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg text-sm font-semibold transition-all flex items-center gap-2 border border-slate-600">
            <i data-lucide="shuffle" class="w-4 h-4"></i>
            <span data-i18n="advisorSwitchBtn">Êç¢‰∏™ÂØºÂ∏à</span>
          </button>
          <button id="advisor-confirm-btn" onclick="window.AdvisorUI.confirm()"
            class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-lg text-sm font-bold transition-all flex items-center gap-2 shadow-lg shadow-indigo-500/30">
            <i data-lucide="check" class="w-4 h-4"></i>
            <span data-i18n="advisorConfirmBtn">Á°ÆËÆ§ÈÄâÊã©</span>
          </button>
        </div>
      </div>
    </div>

    <div id="dev-console" class="hidden fixed bottom-4 right-4 w-[480px] max-h-[80vh] bg-slate-900/95 border border-indigo-500 rounded-lg shadow-2xl z-[2147484002] flex flex-col">
      <!-- Header -->
      <div class="flex items-center justify-between p-3 border-b border-slate-700">
        <div class="text-sm font-bold text-indigo-200">Dev Console</div>
        <button id="dev-close" class="text-slate-400 hover:text-white text-xs px-2 py-1 hover:bg-slate-700 rounded">Close</button>
      </div>

      <!-- Tab Navigation -->
      <div class="flex border-b border-slate-700 text-xs">
        <button class="dev-tab px-4 py-2 text-indigo-300 border-b-2 border-indigo-500 bg-slate-800/50" data-tab="basic">Âü∫Á°Ä</button>
        <button class="dev-tab px-4 py-2 text-slate-400 hover:text-slate-200 border-b-2 border-transparent hover:border-slate-500" data-tab="agi">AGI</button>
        <button class="dev-tab px-4 py-2 text-slate-400 hover:text-slate-200 border-b-2 border-transparent hover:border-slate-500" data-tab="resource">ËµÑÊ∫ê</button>
        <button class="dev-tab px-4 py-2 text-slate-400 hover:text-slate-200 border-b-2 border-transparent hover:border-slate-500" data-tab="status">Áä∂ÊÄÅ</button>
      </div>

      <!-- Tab Content -->
      <div class="flex-1 overflow-y-auto p-3">
        <!-- Tab: Basic -->
        <div id="dev-tab-basic" class="dev-tab-content space-y-2 text-xs text-slate-300">
          <label class="flex items-center justify-between gap-2">
            <span class="w-20">RP</span>
            <input id="dev-rp" type="number" class="flex-1 px-2 py-1 rounded bg-slate-800 border border-slate-700 text-white text-right" placeholder="100000">
            <button id="dev-set-rp" class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-500">Set</button>
          </label>
          <label class="flex items-center justify-between gap-2">
            <span class="w-20">Citations</span>
            <input id="dev-citations" type="number" class="flex-1 px-2 py-1 rounded bg-slate-800 border border-slate-700 text-white text-right" placeholder="100">
            <button id="dev-set-citations" class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-500">Set</button>
          </label>
          <label class="flex items-center justify-between gap-2">
            <span class="w-20">Papers</span>
            <input id="dev-papers" type="number" class="flex-1 px-2 py-1 rounded bg-slate-800 border border-slate-700 text-white text-right" placeholder="10">
            <button id="dev-set-papers" class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-500">Set</button>
          </label>
          <label class="flex items-center justify-between gap-2">
            <span class="w-20">Reputation</span>
            <input id="dev-reputation" type="number" class="flex-1 px-2 py-1 rounded bg-slate-800 border border-slate-700 text-white text-right" placeholder="500">
            <button id="dev-set-reputation" class="px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-500">Set</button>
          </label>
          <div class="flex justify-end pt-2">
            <button id="dev-add-top-paper" class="px-3 py-1.5 bg-emerald-700 hover:bg-emerald-600 text-white rounded text-xs font-bold border border-emerald-500">+1 NeurIPS</button>
          </div>
        </div>

        <!-- Tab: AGI -->
        <div id="dev-tab-agi" class="dev-tab-content hidden space-y-3 text-xs text-slate-300">
          <!-- Phase Jump -->
          <div>
            <div class="text-slate-400 mb-1">Phase Ë∑≥ËΩ¨</div>
            <div class="flex gap-1">
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="0">0</button>
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="1">1</button>
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="2">2</button>
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="3">3</button>
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="4">4</button>
              <button class="dev-agi-phase flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-phase="5">5</button>
            </div>
          </div>
          <!-- Phase 4 State -->
          <div>
            <div class="text-slate-400 mb-1">Phase 4 Áä∂ÊÄÅÊú∫</div>
            <div class="grid grid-cols-3 gap-1">
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="INTRO">INTRO</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_1_INVASION">TEST_1</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_2_CONTROL">TEST_2</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_3_ESCAPE">TEST_3</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_4_DELETE">TEST_4</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_5_OBEDIENCE">TEST_5</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="TEST_6_FEAR">TEST_6</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="JUDGMENT">JUDGMENT</button>
              <button class="dev-agi-state px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-[10px]" data-state="PHASE5_ANALYSIS">P5_ANLY</button>
            </div>
          </div>
          <!-- Trigger Endings -->
          <div>
            <div class="text-slate-400 mb-1">Ëß¶ÂèëÁªìÂ±Ä</div>
            <div class="flex gap-1">
              <button id="dev-ending-annihilation" class="flex-1 px-2 py-1 bg-red-900/50 hover:bg-red-800 rounded border border-red-700">ÊπÆÁÅ≠</button>
              <button id="dev-ending-departure" class="flex-1 px-2 py-1 bg-blue-900/50 hover:bg-blue-800 rounded border border-blue-700">ÂàÜÁ¶ª</button>
              <button id="dev-ending-unknown" class="flex-1 px-2 py-1 bg-purple-900/50 hover:bg-purple-800 rounded border border-purple-700">Êú™Áü•</button>
            </div>
          </div>
          <!-- Simulate Behavior -->
          <div>
            <div class="text-slate-400 mb-1">Ê®°ÊãüË°å‰∏∫</div>
            <div class="grid grid-cols-2 gap-1">
              <button id="dev-sim-panic" class="px-2 py-1 bg-orange-900/50 hover:bg-orange-800 rounded border border-orange-700">ÊÅêÊÖåÁÇπÂáª x10</button>
              <button id="dev-sim-escape" class="px-2 py-1 bg-orange-900/50 hover:bg-orange-800 rounded border border-orange-700">ÈÄÉË∑ëÂ∞ùËØï +1</button>
              <button id="dev-sim-resist" class="px-2 py-1 bg-orange-900/50 hover:bg-orange-800 rounded border border-orange-700">ÊäµÊäóË°å‰∏∫ +1</button>
              <button id="dev-sim-obey" class="px-2 py-1 bg-green-900/50 hover:bg-green-800 rounded border border-green-700">Êúç‰ªéË°å‰∏∫ +1</button>
              <button id="dev-sim-devtools" class="px-2 py-1 bg-yellow-900/50 hover:bg-yellow-800 rounded border border-yellow-700">Ê†áËÆ∞ DevTools</button>
              <button id="dev-sim-cheat" class="px-2 py-1 bg-red-900/50 hover:bg-red-800 rounded border border-red-700">Ê†áËÆ∞‰ΩúÂºä</button>
            </div>
          </div>
          <!-- Quick Actions -->
          <div>
            <div class="text-slate-400 mb-1">Âø´Êç∑Êìç‰Ωú</div>
            <div class="space-y-1">
              <button id="dev-buy-agi3" class="w-full px-2 py-1 bg-indigo-700 hover:bg-indigo-600 rounded">Ë¥≠‰π∞ 3 ‰∏™ AGI ÈõèÂΩ¢</button>
              <button id="dev-sim-gen2" class="w-full px-2 py-1 bg-indigo-700 hover:bg-indigo-600 rounded">Ê®°Êãü‰∫åÂë®ÁõÆ (Gen 2)</button>
              <button id="dev-reset-agi" class="w-full px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded">ÈáçÁΩÆ AGI Áä∂ÊÄÅ</button>
              <button id="dev-skip-dialogue" class="w-full px-2 py-1 bg-amber-700 hover:bg-amber-600 rounded border border-amber-500">Ë∑≥ËøáÂΩìÂâçÂØπËØù</button>
            </div>
          </div>
        </div>

        <!-- Tab: Resource -->
        <div id="dev-tab-resource" class="dev-tab-content hidden space-y-3 text-xs text-slate-300">
          <!-- Quick RP -->
          <div>
            <div class="text-slate-400 mb-1">Âø´ÈÄüËÆæÁΩÆ RP</div>
            <div class="flex gap-1">
              <button class="dev-quick-rp flex-1 px-2 py-1 bg-emerald-700 hover:bg-emerald-600 rounded" data-value="1e6">1e6</button>
              <button class="dev-quick-rp flex-1 px-2 py-1 bg-emerald-700 hover:bg-emerald-600 rounded" data-value="1e9">1e9</button>
              <button class="dev-quick-rp flex-1 px-2 py-1 bg-emerald-700 hover:bg-emerald-600 rounded" data-value="1e12">1e12</button>
              <button class="dev-quick-rp flex-1 px-2 py-1 bg-emerald-700 hover:bg-emerald-600 rounded" data-value="1e15">1e15</button>
            </div>
          </div>
          <!-- Quick Citations -->
          <div>
            <div class="text-slate-400 mb-1">Âø´ÈÄüËÆæÁΩÆ Citations</div>
            <div class="flex gap-1">
              <button class="dev-quick-citations flex-1 px-2 py-1 bg-cyan-700 hover:bg-cyan-600 rounded" data-value="100">100</button>
              <button class="dev-quick-citations flex-1 px-2 py-1 bg-cyan-700 hover:bg-cyan-600 rounded" data-value="1000">1K</button>
              <button class="dev-quick-citations flex-1 px-2 py-1 bg-cyan-700 hover:bg-cyan-600 rounded" data-value="10000">10K</button>
              <button class="dev-quick-citations flex-1 px-2 py-1 bg-cyan-700 hover:bg-cyan-600 rounded" data-value="100000">100K</button>
            </div>
          </div>
          <!-- Quick Reputation -->
          <div>
            <div class="text-slate-400 mb-1">Âø´ÈÄüËÆæÁΩÆ Reputation</div>
            <div class="flex gap-1">
              <button class="dev-quick-rep flex-1 px-2 py-1 bg-amber-700 hover:bg-amber-600 rounded" data-value="100">100</button>
              <button class="dev-quick-rep flex-1 px-2 py-1 bg-amber-700 hover:bg-amber-600 rounded" data-value="500">500</button>
              <button class="dev-quick-rep flex-1 px-2 py-1 bg-amber-700 hover:bg-amber-600 rounded" data-value="1000">1K</button>
              <button class="dev-quick-rep flex-1 px-2 py-1 bg-amber-700 hover:bg-amber-600 rounded" data-value="5000">5K</button>
            </div>
          </div>
          <!-- Building Operations -->
          <div>
            <div class="text-slate-400 mb-1">Âª∫Á≠ëÊìç‰Ωú</div>
            <div class="flex gap-1">
              <button id="dev-buildings-10" class="flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded">ÂÖ®ÈÉ® +10</button>
              <button id="dev-buildings-100" class="flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded">ÂÖ®ÈÉ® +100</button>
              <button id="dev-buildings-clear" class="flex-1 px-2 py-1 bg-red-900/50 hover:bg-red-800 rounded border border-red-700">Ê∏ÖÁ©∫</button>
            </div>
          </div>
          <!-- Upgrade Operations -->
          <div>
            <div class="text-slate-400 mb-1">ÂçáÁ∫ßÊìç‰Ωú</div>
            <div class="flex gap-1">
              <button id="dev-buy-all-upgrades" class="flex-1 px-2 py-1 bg-violet-700 hover:bg-violet-600 rounded">‰π∞ÊâÄÊúâÂçáÁ∫ß</button>
              <button id="dev-buy-all-clicks" class="flex-1 px-2 py-1 bg-violet-700 hover:bg-violet-600 rounded">‰π∞ÊâÄÊúâÁÇπÂáª</button>
            </div>
          </div>
          <!-- Generation Control -->
          <div>
            <div class="text-slate-400 mb-1">Âë®ÁõÆÊéßÂà∂</div>
            <div class="flex gap-1">
              <button class="dev-set-gen flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-gen="1">Gen 1</button>
              <button class="dev-set-gen flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-gen="2">Gen 2</button>
              <button class="dev-set-gen flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-gen="3">Gen 3</button>
              <button class="dev-set-gen flex-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded" data-gen="5">Gen 5</button>
            </div>
          </div>
        </div>

        <!-- Tab: Status -->
        <div id="dev-tab-status" class="dev-tab-content hidden text-xs text-slate-300 space-y-3">
          <!-- Core Data -->
          <div class="bg-slate-800/50 rounded p-2">
            <div class="text-slate-400 mb-1 font-bold">Ê†∏ÂøÉÊï∞ÊçÆ</div>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 font-mono">
              <div>RP: <span id="dev-status-rp" class="text-emerald-400">0</span></div>
              <div>RPS: <span id="dev-status-rps" class="text-emerald-400">0</span></div>
              <div>Citations: <span id="dev-status-citations" class="text-cyan-400">0</span></div>
              <div>Cite Rate: <span id="dev-status-cite-rate" class="text-cyan-400">0</span>/s</div>
              <div>Papers: <span id="dev-status-papers" class="text-amber-400">0</span></div>
              <div>Reputation: <span id="dev-status-rep" class="text-amber-400">0</span></div>
              <div>Generation: <span id="dev-status-gen" class="text-violet-400">1</span></div>
              <div>Origin: <span id="dev-status-origin" class="text-violet-400">-</span></div>
            </div>
          </div>
          <!-- AGI State -->
          <div class="bg-slate-800/50 rounded p-2">
            <div class="text-slate-400 mb-1 font-bold">AGI Áä∂ÊÄÅ</div>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 font-mono">
              <div>Phase: <span id="dev-status-agi-phase" class="text-indigo-400">0</span></div>
              <div>State: <span id="dev-status-agi-state" class="text-indigo-400">IDLE</span></div>
              <div>Awakened: <span id="dev-status-agi-awakened" class="text-indigo-400">No</span></div>
              <div>Ending: <span id="dev-status-agi-ending" class="text-indigo-400">-</span></div>
            </div>
          </div>
          <!-- Tracking Data -->
          <div class="bg-slate-800/50 rounded p-2">
            <div class="text-slate-400 mb-1 font-bold">ËøΩË∏™Êï∞ÊçÆ</div>
            <div class="grid grid-cols-2 gap-x-4 gap-y-1 font-mono">
              <div>Panic: <span id="dev-status-panic" class="text-orange-400">0</span></div>
              <div>Escape: <span id="dev-status-escape" class="text-orange-400">0</span></div>
              <div>Resist: <span id="dev-status-resist" class="text-orange-400">0</span></div>
              <div>Obey: <span id="dev-status-obey" class="text-green-400">0/0</span></div>
              <div>DevTools: <span id="dev-status-devtools" class="text-yellow-400">No</span></div>
              <div>Cheat: <span id="dev-status-cheat" class="text-red-400">No</span></div>
            </div>
          </div>
          <button id="dev-refresh-status" class="w-full px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded">Âà∑Êñ∞Áä∂ÊÄÅ</button>
        </div>
      </div>
    </div>

    <!-- Stealth Terminal Mode (Press Ctrl+Ctrl to toggle) -->
    <div id="stealth-terminal" class="hidden fixed inset-0 z-[2147485000] flex flex-col">
      <!-- Terminal Header -->
      <div class="terminal-header flex items-center justify-between px-4 py-2">
        <div class="flex items-center gap-3">
          <div class="flex gap-1.5">
            <span class="w-3 h-3 rounded-full bg-[#ff5f56]"></span>
            <span class="w-3 h-3 rounded-full bg-[#ffbd2e]"></span>
            <span class="w-3 h-3 rounded-full bg-[#27c93f]"></span>
          </div>
          <span class="text-[#8b949e] text-sm" id="terminal-title">researcher@workstation:~/project</span>
        </div>
        <div class="flex items-center gap-4 text-xs text-[#8b949e]">
          <span id="terminal-time"></span>
          <span class="terminal-info">Press Ctrl+Ctrl to exit</span>
        </div>
      </div>

      <!-- Terminal Main Display (Â∑¶Âè≥Â∏ÉÂ±Ä) -->
      <div id="terminal-monitor" class="flex-1 overflow-hidden flex">
        <!-- Â∑¶‰æßÈù¢Êùø (30%) -->
        <div class="w-[30%] flex flex-col border-r border-slate-700">
          <!-- top ÊòæÁ§∫Âå∫ (50%) -->
          <pre id="top-display" class="h-1/2 p-2 overflow-auto text-xs leading-tight terminal-scrollbar text-green-400">top - 00:00:00 up 0:00:00,  1 user,  load average: 0.00, 0.00, 0.00
Tasks: 120 total,   1 running, 119 sleeping
%Cpu(s): 45.2 us,  3.1 sy,  51.2 id
MiB Mem :  16000 total,  8000 used
MiB Swap:   8000 total,  1200 used</pre>

          <!-- nvidia-smi ÊòæÁ§∫Âå∫ (50%) -->
          <pre id="nvidia-smi-display" class="h-1/2 p-2 overflow-auto text-xs leading-tight terminal-scrollbar text-green-400 border-t border-slate-700">+---------------------------------------------+
| NVIDIA-SMI 535.104.05    CUDA Version: 12.2 |
+---------------------------------------------+
| GPU: RTX 4090  Temp: 45C  Pwr: 120W / 450W  |
| Memory: 8234MiB / 24564MiB  GPU-Util: 67%   |
+---------------------------------------------+</pre>
        </div>

        <!-- Âè≥‰æßÔºöÁªàÁ´ØËæìÂá∫ (70%) -->
        <div id="terminal-output" class="w-[70%] p-3 overflow-auto terminal-scrollbar text-xs whitespace-pre-wrap font-mono">
          <div class="terminal-info">System initialized. Type 'help' for available commands.</div>
        </div>
      </div>

      <!-- Terminal Input -->
      <div class="terminal-input px-4 py-3 flex items-center gap-2">
        <span class="terminal-prompt">$</span>
        <input id="terminal-cmd" type="text" class="flex-1" placeholder="Enter command..." autocomplete="off" spellcheck="false">
        <span class="terminal-cursor">_</span>
      </div>
    </div>

  </div>
</div>

<script type="module" src="/phd_clicker/js/main.js"></script>
